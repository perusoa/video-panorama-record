parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"D9Nj":[function(require,module,exports) {

},{}],"H99C":[function(require,module,exports) {
"use strict";require("./styles.css"),Vue.component("video-player-loader",{template:'\n    <div class="c-video-player-loader">\n      <div class="preloader-wrapper big active">\n        <div class="spinner-layer spinner-blue-only">\n          <div class="circle-clipper left">\n            <div class="circle"></div>\n          </div><div class="gap-patch">\n            <div class="circle"></div>\n          </div><div class="circle-clipper right">\n            <div class="circle"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '}),Vue.component("video-player-controls",{props:["video","currentTime","duration","videoMode","panorama"],template:'\n    <div class="c-video-player-controls">\n      <div ref="progressBar" class="c-video-player-controls__progress-bar" @click="updateTime" @mousemove="updateHoveredTime">\n        <div class="c-video-player-controls__progress" :style="{ flexBasis: progress + \'%\', maxWidth: progress + \'%\' }"></div>\n        <span ref="progressTime" class="c-video-player-controls__progress-time">{{ hoveredTime | prettyTime }}</span>\n      </div>\n      <div class="c-video-player-controls__wrapper">\n        <button @click="togglePlayPause" class="c-video-player-controls__play-pause">\n          <i v-if="!isPlaying" class="material-icons">play_arrow</i>\n          <i v-if="isPlaying" class="material-icons">pause</i>\n        </button>\n        <button class="c-video-player-controls__volume" @click="toggleVolume">\n          <i v-if="volume === 1" class="material-icons">volume_up</i>\n          <i v-if="volume === 0" class="material-icons">volume_off</i>\n        </button>\n        <div class="c-video-player-controls__time">\n          {{ currentTime | prettyTime }} / {{ duration | prettyTime }}\n        </div>\n        <button class="c-video-player-controls__mode btn btn-small btn-flat" @click="$emit(\'change-video-mode\')">\n          {{ videoMode === \'panorama\' ? \'Standard\' : \'Panorama\' }} View\n        </button>\n        <button v-if="videoMode === \'panorama\' && browserCanRecord" class="c-video-player-controls__record" :class="{ \'c-video-player-controls__record--recording\': isRecording }" @click="toggleRecording">\n          Rec\n          <i class="material-icons">fiber_manual_record</i>\n          ({{ recordingTime }})\n        </button>\n        <select class="c-video-player-controls__playback" v-model="playbackRate" @change="updatePlayback">\n          <option :value="0.5">0.5x</option>\n          <option :value="1.0">1x</option>\n          <option :value="1.5">1.5x</option>\n          <option :value="2.0">2x</option>\n        </select>\n        <div class="c-video-player-controls__seeks">\n          <button class="c-video-player-controls__seek" @click="seekVideo(-10)">\n            <i class="material-icons">replay_10</i>\n          </button>\n          <button class="c-video-player-controls__seek" @click="seekVideo(10)">\n            <i class="material-icons">forward_10</i>\n          </button>\n        </div>\n        <button @click="toggleFullscreen" class="c-video-player-controls__fullscreen">\n          <i class="material-icons">fullscreen</i>\n        </button>\n      </div>\n    </div>\n  ',data:function(){return{isPlaying:!this.video.paused,volume:1,playbackRate:1,progress:0,hoveredTime:0,isRecording:!1,videoChunks:[],videoStream:null,mediaRecorder:null,recordingInterval:null,recordingTime:0,browserCanRecord:!1}},mounted:function(){this.updateProgress(),"panorama"===this.videoMode&&MediaRecorder.isTypeSupported("video/webm")&&(this.browserCanRecord=!0,this.initializeVideoStream())},methods:{updateProgress:function(){this.progress=this.currentTime/this.duration*100},updateTime:function(e){var i=e.offsetX/this.$refs.progressBar.clientWidth;this.video.currentTime=this.duration*i},updateHoveredTime:function(e){var i=e.offsetX/this.$refs.progressBar.clientWidth;this.hoveredTime=this.duration*i,this.$refs.progressTime.style.left="calc("+100*i+"% - "+this.$refs.progressTime.clientWidth/2+"px)"},togglePlayPause:function(){this.video.paused?(this.video.play(),this.isPlaying=!0):(this.video.pause(),this.isPlaying=!1)},seekVideo:function(e){this.video.currentTime+=e},updatePlayback:function(e){this.video.playbackRate=e.target.value},toggleVolume:function(){this.volume=1===this.volume?0:1,0===this.volume?(this.video.muted=!0,this.video.volume=0):(this.video.muted=!1,this.video.volume=1)},toggleFullscreen:function(){this.video.requestFullscreen?this.video.requestFullscreen():this.video.webkitRequestFullscreen?this.video.webkitRequestFullscreen():this.video.msRequestFullscreen?this.video.msRequestFullscreen():this.video.webkitEnterFullScreen&&this.video.webkitEnterFullScreen()},initializeVideoStream:function(){var e,i=this;this.videoStream=this.panorama.captureStream(),e=MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?{mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?{mimeType:"video/webm; codecs=vp8"}:{mimeType:"video/webm"},this.mediaRecorder=new MediaRecorder(this.videoStream,e),this.mediaRecorder.addEventListener("dataavailable",function(e){i.videoChunks.push(e.data)}),this.mediaRecorder.addEventListener("stop",function(e){var o=new Blob(i.videoChunks,{type:"video/webm"});i.videoChunks=[],i.clippedVideo=URL.createObjectURL(o),window.confirm("Are you sure you want to download this clip?")&&i.downloadVideoFile(o,uuidv4()+".webm")})},toggleRecording:function(){this.isRecording?this.stopVideoRecording():this.startVideoRecording()},startVideoRecording:function(){var e=this;this.mediaRecorder.start(1e3),this.isRecording=!0,this.recordingInterval=setInterval(function(){e.recordingTime++,e.recordingTime>60&&e.stopVideoRecording()},1e3)},stopVideoRecording:function(){this.mediaRecorder.stop(),this.isRecording=!1,clearInterval(this.recordingInterval),this.recordingTime=0},downloadVideoFile:function(e,i,o,t){var a=new Blob(void 0!==t?[t,e]:[e],{type:o||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,i);else{var n=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(a):window.webkitURL.createObjectURL(a),s=document.createElement("a");s.style.display="none",s.href=n,s.setAttribute("download",i),void 0===s.download&&s.setAttribute("target","_blank"),document.body.appendChild(s),s.click(),setTimeout(function(){document.body.removeChild(s),window.URL.revokeObjectURL(n)},200)}}},watch:{currentTime:function(){this.updateProgress()}},filters:{prettyTime:function(e){var i=~~(e/3600),o=~~(e%3600/60),t=~~e%60,a="";return i>0&&(a+=i+":"+(o<10?"0":"")),a+=o+":"+(t<10?"0":""),a+=""+t}}}),Vue.component("video-player",{props:["hdVideoUrl","panoramaVideoUrl"],template:'\n    <div class="c-video-player">\n      <div v-if="isPanoramaMode" ref="panoramaWrapper" class="c-video-player__video">\n        <div class="c-video-player__help-text" ref="panoramaHelpText">Click &amp; Drag To Navigate Panorama</div>\n        <canvas ref="panorama" class="c-video-player__canvas"></canvas>\n        <video-player-controls\n          v-if="video && panorama"\n          :video="video"\n          :current-time="currentTime"\n          :duration="duration"\n          :video-mode="videoMode"\n          :panorama="panorama"\n          @change-video-mode="toggleVideoMode">\n        </video-player-controls>\n        <video-player-loader v-if="isLoading"></video-player-loader>\n      </div>\n      <div class="c-video-player__video" :class="{ \'c-video-player__video--panorama\': isPanoramaMode }">\n        <video\n          data-id="<%= @game.id %>"\n          data-user="<%= current_user.email %>"\n          data-clip-settings="<%= ClipSetting.first.max_clips %>"\n          data-download-clip="<%= @user_game.download_full_clip %>"\n          data-download-partial-clip="<%= @user_game.download_partial_clip %>"\n          data-refund-payment="<%= @refunded_payments %>"\n          ref="video"\n          class="c-video-player__player"\n          :src="currentVideo"\n          width="3840"\n          height="900"\n          playsinline\n          @timeupdate="updateTime"\n          @loadedmetadata="updateDuration"\n        >\n          <source :src="currentVideo" type="video/mp4">\n        </video>\n        <video-player-controls\n          v-if="video && !isPanoramaMode"\n          :video="video"\n          :current-time="currentTime"\n          :duration="duration"\n          :video-mode="videoMode"\n          @change-video-mode="toggleVideoMode">\n        </video-player-controls>\n      </div>\n    </div>\n  ',data:function(){return{isLoading:!1,videoMode:"panorama",canvas:null,video:null,videoEl:null,panorama:null,xBoundary:0,yBoundary:0,currentX:0,currentY:0,zoom:1,currentTime:0,duration:0}},computed:{currentVideo:function(){return"panorama"===this.videoMode?this.panoramaVideoUrl:this.hdVideoUrl},isPanoramaMode:function(){return"panorama"===this.videoMode}},mounted:function(){this.isLoading=!0,this.video=this.$refs.video,"panorama"===this.videoMode&&this.initializeVideoCanvas()},methods:{initializeVideoCanvas:function(){var e=this;this.sizeCanvas(),window.addEventListener("resize",this.resizeCanvas),this.canvas=new fabric.Canvas(this.$refs.panorama),this.canvas.selection=!1,this.panorama=this.$refs.panorama,this.videoEl=new fabric.Image(this.video,{left:0,top:0,objectCaching:!1,hasControls:!1,hasBorders:!1,centeredScaling:!0}),this.videoEl.scaleToHeight(this.panorama.clientHeight),this.canvas.add(this.videoEl),this.canvas.centerObject(this.videoEl);fabric.util.requestAnimFrame(function i(){e.canvas.renderAll(),fabric.util.requestAnimFrame(i)}),this.canvas.on("object:moving",this.handleCanvasBoundaries),this.canvas.on("mouse:wheel",this.setZoom),this.canvas.on("mouse:down",function(){e.$refs.panoramaHelpText.classList.add("is-hidden")}),this.currentX=this.videoEl.left,this.currentY=this.videoEl.top},handleCanvasBoundaries:function(e){var i,o,t=e.target,a=this.panorama.clientWidth,n=this.panorama.clientHeight;t.setCoords(),this.xBoundary=a-t.getScaledWidth(),this.yBoundary=n-t.getScaledHeight();t.getBoundingRect();i=(this.canvas.getWidth()*this.zoom-this.canvas.getWidth())/4,o=(this.canvas.getHeight()*this.zoom-this.canvas.getHeight())/4,this.xBoundary=this.xBoundary-i/2,this.yBoundary=this.yBoundary-o/2,t.left>i?t.left=i:t.left<this.xBoundary&&(t.left=this.xBoundary),t.top>o?t.top=o:t.top<this.yBoundary&&(t.top=this.yBoundary)},toggleVideoMode:function(){var e=this;this.videoMode="panorama"===this.videoMode?"hd":"panorama","panorama"===this.videoMode&&this.$nextTick(function(){e.initializeVideoCanvas()})},sizeCanvas:function(){this.$refs.panorama.width=this.$refs.panoramaWrapper.clientWidth,this.$refs.panorama.height=this.$refs.panoramaWrapper.clientHeight},resizeCanvas:function(){this.canvas.setWidth(this.$refs.panoramaWrapper.clientWidth),this.canvas.setHeight(this.$refs.panoramaWrapper.clientHeight),this.videoEl.scaleToHeight(this.panorama.clientHeight),this.canvas.calcOffset(),this.canvas.centerObject(this.videoEl)},updateTime:function(e){this.currentTime=e.target.currentTime},updateDuration:function(e){this.isLoading=!1,this.duration=e.target.duration},setZoom:function(e){var i=e.e;this.zoom+=-.01*i.deltaY,this.zoom=Number(Math.min(Math.max(1,this.zoom),4).toFixed(2));var o=this.canvas.getCenter();this.canvas.zoomToPoint({x:o.left,y:o.top},this.zoom),this.videoEl.setCoords(),i.preventDefault(),i.stopPropagation(),this.canvas.fire("object:moving",{target:this.videoEl})}},watch:{currentVideo:function(){var e=this;this.isLoading=!0,this.$nextTick(function(){e.video.currentTime=e.currentTime,e.$forceUpdate()})}}}),new Vue({el:"#app"});
},{"./styles.css":"D9Nj"}]},{},["H99C"], null)
//# sourceMappingURL=/src.a4010a68.js.map